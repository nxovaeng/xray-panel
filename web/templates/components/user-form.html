{{define "components/user-form.html"}}
<form hx-post="/api/users{{if .User}}/{{.User.ID}}{{end}}" 
      hx-target="#users-table" 
      hx-swap="innerHTML"
      hx-on::after-request="if(event.detail.successful) { closeModal(); showNotification('ç”¨æˆ·å·²ä¿å­˜', 'success'); } else { showNotification('ä¿å­˜å¤±è´¥: ' + event.detail.xhr.responseText, 'error'); }">

    <div class="form-group">
        <label for="name">ç”¨æˆ·å</label>
        <input type="text" id="name" name="name" value="{{if .User}}{{.User.Name}}{{end}}" 
               placeholder="ç”¨æˆ·çš„æ˜¾ç¤ºåç§°" required>
        <small class="form-hint">ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œä¹Ÿä¼šç”¨ä½œè®¢é˜…æ–‡ä»¶å</small>
    </div>

    <div class="form-group">
        <label for="email">é‚®ç®±</label>
        <input type="email" id="email" name="email" value="{{if .User}}{{.User.Email}}{{end}}" 
               placeholder="user@example.com" required>
        <small class="form-hint">ç”¨äºç™»å½•å’Œé€šçŸ¥</small>
    </div>

    <div class="form-group">
        <label for="uuid">UUID</label>
        <div style="display: flex; gap: 0.5rem;">
            <input type="text" id="uuid" name="uuid" 
                   value="{{if .User}}{{.User.UUID}}{{else}}{{.GeneratedUUID}}{{end}}"
                   placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥" required 
                   style="flex: 1; font-family: monospace; font-size: 0.9rem;">
            <button type="button" onclick="document.getElementById('uuid').value = generateUUID()" 
                    class="btn btn-sm btn-outline" title="ç”Ÿæˆæ–° UUID">
                <i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>
            </button>
        </div>
        <small class="form-hint">ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äº VLESS/Trojan è¿æ¥</small>
    </div>

    <div class="form-group">
        <label for="traffic_limit">æµé‡é™åˆ¶ (GB)</label>
        <input type="number" id="traffic_limit" name="traffic_limit" 
               value="{{if .User}}{{bytesToGB .User.TrafficLimit}}{{else}}100{{end}}" 
               min="0" step="1" placeholder="100">
        <small class="form-hint">ç”¨æˆ·å¯ä½¿ç”¨çš„æ€»æµé‡ï¼Œ0 è¡¨ç¤ºæ— é™åˆ¶</small>
    </div>

    <div class="form-group">
        <label for="expiry_date">åˆ°æœŸæ—¥æœŸ</label>
        <input type="date" id="expiry_date" name="expiry_date" 
               value="{{if .User}}{{if not .User.ExpiryDate.IsZero}}{{formatDate .User.ExpiryDate}}{{end}}{{end}}">
        <small class="form-hint">ç•™ç©ºè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ</small>
    </div>

    <div class="form-group">
        <label for="enabled">çŠ¶æ€</label>
        <select id="enabled" name="enabled">
            <option value="true" {{if or (not .User) .User.Enabled}}selected{{end}}>âœ… å¯ç”¨</option>
            <option value="false" {{if and .User (not .User.Enabled)}}selected{{end}}>ğŸš« ç¦ç”¨</option>
        </select>
        <small class="form-hint">ç¦ç”¨åç”¨æˆ·æ— æ³•ä½¿ç”¨è®¢é˜…</small>
    </div>

    <div class="form-actions">
        <button type="button" onclick="closeModal()" class="btn">å–æ¶ˆ</button>
        <button type="submit" class="btn btn-primary">
            {{if .User}}æ›´æ–°{{else}}åˆ›å»º{{end}}
        </button>
    </div>
</form>

<script>
    // Re-initialize icons
    if (window.lucide) lucide.createIcons();
</script>
{{end}}